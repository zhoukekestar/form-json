<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>methods</title>
    <script src='../src/form-json.js'></script>
  </head>
  <body>
    <form action='https://api.github.com/gists/7796dfa3e275707f23a16ac9ceb9ce15' enctype="application/form-json">
      <input name='a' value='b' />
      <input type='submit' />
    </form>

    <script>
      var form = document.querySelector('form');

      form.beforeSend = function (xhr) {
        xhr.setRequestHeader('X-Requested-With', 'form-json');
      }

      form.beforeStringify = function (data) {
        data.beforeStringify = true;
        return data;
      }
      /**
       * POST data:
       * {
       *  "a": "b",
       *  "beforeStringify": true
       * }
       */
      form.onsuccess = function (data) {
        console.log('response success: ', data);
      }

      form.onerror = function (xhr) {
        console.log('response error: ', xhr.response)
      }

      document.body.addEventListener('sumit', function () {
        this.beforeStringify = function (d) {
          document.querySelector('textarea').value = JSON.stringify(null, 2, d);
        }
      })
    </script>
  </body>
</html>
